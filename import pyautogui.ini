import pyautogui
import cv2
import numpy as np
from PIL import ImageGrab
import time

def detect_blue_and_click():
    # กำหนดพื้นที่กรอบ (ปรับค่า x, y, width, height ตามต้องการ)
    x, y, width, height = 100, 100, 300, 300  # พื้นที่ที่ต้องการตรวจสอบ
    while True:
        # จับภาพหน้าจอในกรอบที่กำหนด
        screenshot = ImageGrab.grab(bbox=(x, y, x + width, y + height))
        frame = np.array(screenshot)
        frame = cv2.cvtColor(frame, cv2.COLOR_BGR2RGB)

        # แปลงภาพเป็นโหมด HSV
        hsv_frame = cv2.cvtColor(frame, cv2.COLOR_RGB2HSV)

        # ช่วงค่าสีฟ้าใน HSV
        lower_blue = np.array([90, 50, 50])
        upper_blue = np.array([130, 255, 255])

        # ตรวจจับสีฟ้า
        mask = cv2.inRange(hsv_frame, lower_blue, upper_blue)
        blue_detected = cv2.countNonZero(mask)

        if blue_detected > 0:
            # คลิกเมาส์ที่ตำแหน่งกลางของกรอบ
            pyautogui.click(x + width // 2, y + height // 2)
            print("สีฟ้าตรวจพบและคลิกแล้ว!")
            time.sleep(1)  # หน่วงเวลา 1 วินาทีเพื่อหลีกเลี่ยงการกดซ้ำ

        # แสดงผลหน้าต่างสำหรับ Debug (สามารถลบออกได้)
        cv2.imshow("Debug", mask)

        # กด 'q' เพื่อออกจากโปรแกรม
        if cv2.waitKey(1) & 0xFF == ord('q'):
            break

    cv2.destroyAllWindows()

# เรียกใช้งานฟังก์ชัน
detect_blue_and_click()
