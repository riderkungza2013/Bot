<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OCR สลิป</title>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.1.1/dist/tesseract.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background-color: #f5f5f5; }
    input, button { margin: 10px 0; }
    img { max-width: 300px; display: block; margin: 10px 0; }
    #result { background: #fff; padding: 10px; border-radius: 8px; }
  </style>
</head>
<body>

<h2>OCR สลิป + Parsing</h2>
<input type="file" id="fileInput" accept="image/*">
<img id="preview" src="" alt="">
<button onclick="doOCR()">เริ่ม OCR</button>

<div id="result">
  <h3>ผลลัพธ์</h3>
  <p><strong>ชื่อผู้รับเงิน:</strong> <span id="name"></span></p>
  <p><strong>จำนวนเงิน:</strong> <span id="amount"></span></p>
  <p><strong>ข้อความทั้งหมด:</strong></p>
  <pre id="fullText"></pre>
</div>

<script>
  const fileInput = document.getElementById('fileInput');
  const preview = document.getElementById('preview');

  fileInput.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if(file){
      preview.src = URL.createObjectURL(file);
    }
  });

  async function doOCR() {
    const file = fileInput.files[0];
    if(!file) return alert("โปรดเลือกภาพก่อน");

    document.getElementById('fullText').textContent = "กำลังประมวลผล...";

    const { data: { text } } = await Tesseract.recognize(file, 'tha+eng', { logger: m => console.log(m) });
    
    document.getElementById('fullText').textContent = text;

    // Parsing ชื่อผู้รับเงิน (ตัวอย่างง่าย)
    const nameMatch = text.match(/ไปยัง\s+([ก-ฮ\s\.]+)/);
    document.getElementById('name').textContent = nameMatch ? nameMatch[1].trim() : "ไม่พบ";

    // Parsing จำนวนเงิน
    const amountMatch = text.match(/จำนวนเงิน\s+([\d,.]+)/);
    document.getElementById('amount').textContent = amountMatch ? amountMatch[1].trim() : "ไม่พบ";
  }
</script>

</body>
</html>
